var Ce=Object.create;var Q=Object.defineProperty;var Be=Object.getOwnPropertyDescriptor;var qe=Object.getOwnPropertyNames;var Ve=Object.getPrototypeOf,Ye=Object.prototype.hasOwnProperty;var Ge=(i,s)=>()=>(s||i((s={exports:{}}).exports,s),s.exports);var Qe=(i,s,c,u)=>{if(s&&typeof s=="object"||typeof s=="function")for(let p of qe(s))!Ye.call(i,p)&&p!==c&&Q(i,p,{get:()=>s[p],enumerable:!(u=Be(s,p))||u.enumerable});return i};var O=(i,s,c)=>(c=i!=null?Ce(Ve(i)):{},Qe(s||!i||!i.__esModule?Q(c,"default",{value:i,enumerable:!0}):c,i));var ee=Ge((F,x)=>{(function(i,s){typeof F=="object"&&typeof x<"u"?s(F):typeof define=="function"&&define.amd?define(["exports"],s):(i=typeof globalThis<"u"?globalThis:i||self,s(i.Superstruct={}))})(F,function(i){"use strict";class s extends TypeError{constructor(n,t){let r,{message:o,explanation:a,...f}=n,{path:b}=n,g=b.length===0?o:`At path: ${b.join(".")} -- ${o}`;super(a??g),a!=null&&(this.cause=g),Object.assign(this,f),this.name=this.constructor.name,this.failures=()=>r??(r=[n,...t()])}}function c(e){return u(e)&&typeof e[Symbol.iterator]=="function"}function u(e){return typeof e=="object"&&e!=null}function p(e){return u(e)&&!Array.isArray(e)}function S(e){if(Object.prototype.toString.call(e)!=="[object Object]")return!1;let n=Object.getPrototypeOf(e);return n===null||n===Object.prototype}function m(e){return typeof e=="symbol"?e.toString():typeof e=="string"?JSON.stringify(e):`${e}`}function M(e){let{done:n,value:t}=e.next();return n?void 0:t}function E(e,n,t,r){if(e===!0)return;e===!1?e={}:typeof e=="string"&&(e={message:e});let{path:o,branch:a}=n,{type:f}=t,{refinement:b,message:g=`Expected a value of type \`${f}\`${b?` with refinement \`${b}\``:""}, but received: \`${m(r)}\``}=e;return{value:r,type:f,refinement:b,key:o[o.length-1],path:o,branch:a,...e,message:g}}function*y(e,n,t,r){c(e)||(e=[e]);for(let o of e){let a=E(o,n,t,r);a&&(yield a)}}function*k(e,n,t={}){let{path:r=[],branch:o=[e],coerce:a=!1,mask:f=!1}=t,b={path:r,branch:o,mask:f};a&&(e=n.coercer(e,b));let g="valid";for(let w of n.validator(e,b))w.explanation=t.message,g="not_valid",yield[w,void 0];for(let[w,j,He]of n.entries(e,b)){let Le=k(j,He,{path:w===void 0?r:[...r,w],branch:w===void 0?o:[...o,j],coerce:a,mask:f,message:t.message});for(let T of Le)T[0]?(g=T[0].refinement!=null?"not_refined":"not_valid",yield[T[0],void 0]):a&&(j=T[1],w===void 0?e=j:e instanceof Map?e.set(w,j):e instanceof Set?e.add(j):u(e)&&(j!==void 0||w in e)&&(e[w]=j))}if(g!=="not_valid")for(let w of n.refiner(e,b))w.explanation=t.message,g="not_refined",yield[w,void 0];g==="valid"&&(yield[void 0,e])}class l{constructor(n){let{type:t,schema:r,validator:o,refiner:a,coercer:f=g=>g,entries:b=function*(){}}=n;this.type=t,this.schema=r,this.entries=b,this.coercer=f,o?this.validator=(g,w)=>{let j=o(g,w);return y(j,w,this,g)}:this.validator=()=>[],a?this.refiner=(g,w)=>{let j=a(g,w);return y(j,w,this,g)}:this.refiner=()=>[]}assert(n,t){return N(n,this,t)}create(n,t){return A(n,this,t)}is(n){return I(n,this)}mask(n,t){return J(n,this,t)}validate(n,t={}){return W(n,this,t)}}function N(e,n,t){let r=W(e,n,{message:t});if(r[0])throw r[0]}function A(e,n,t){let r=W(e,n,{coerce:!0,message:t});if(r[0])throw r[0];return r[1]}function J(e,n,t){let r=W(e,n,{coerce:!0,mask:!0,message:t});if(r[0])throw r[0];return r[1]}function I(e,n){return!W(e,n)[0]}function W(e,n,t={}){let r=k(e,n,t),o=M(r);return o[0]?[new s(o[0],function*(){for(let f of r)f[0]&&(yield f[0])}),void 0]:[void 0,o[1]]}function se(...e){let n=e[0].type==="type",t=e.map(o=>o.schema),r=Object.assign({},...t);return n?z(r):R(r)}function P(e,n){return new l({type:e,schema:null,validator:n})}function ae(e,n){return new l({...e,refiner:(t,r)=>t===void 0||e.refiner(t,r),validator(t,r){return t===void 0?!0:(n(t,r),e.validator(t,r))}})}function ce(e){return new l({type:"dynamic",schema:null,*entries(n,t){yield*e(n,t).entries(n,t)},validator(n,t){return e(n,t).validator(n,t)},coercer(n,t){return e(n,t).coercer(n,t)},refiner(n,t){return e(n,t).refiner(n,t)}})}function fe(e){let n;return new l({type:"lazy",schema:null,*entries(t,r){n??(n=e()),yield*n.entries(t,r)},validator(t,r){return n??(n=e()),n.validator(t,r)},coercer(t,r){return n??(n=e()),n.coercer(t,r)},refiner(t,r){return n??(n=e()),n.refiner(t,r)}})}function de(e,n){let{schema:t}=e,r={...t};for(let o of n)delete r[o];switch(e.type){case"type":return z(r);default:return R(r)}}function ue(e){let n=e instanceof l,t=n?{...e.schema}:{...e};for(let r in t)t[r]=q(t[r]);return n&&e.type==="type"?z(t):R(t)}function le(e,n){let{schema:t}=e,r={};for(let o of n)r[o]=t[o];switch(e.type){case"type":return z(r);default:return R(r)}}function pe(e,n){return console.warn("superstruct@0.11 - The `struct` helper has been renamed to `define`."),P(e,n)}function me(){return P("any",()=>!0)}function ye(e){return new l({type:"array",schema:e,*entries(n){if(e&&Array.isArray(n))for(let[t,r]of n.entries())yield[t,r,e]},coercer(n){return Array.isArray(n)?n.slice():n},validator(n){return Array.isArray(n)||`Expected an array value, but received: ${m(n)}`}})}function he(){return P("bigint",e=>typeof e=="bigint")}function be(){return P("boolean",e=>typeof e=="boolean")}function ge(){return P("date",e=>e instanceof Date&&!isNaN(e.getTime())||`Expected a valid \`Date\` object, but received: ${m(e)}`)}function we(e){let n={},t=e.map(r=>m(r)).join();for(let r of e)n[r]=r;return new l({type:"enums",schema:n,validator(r){return e.includes(r)||`Expected one of \`${t}\`, but received: ${m(r)}`}})}function ke(){return P("func",e=>typeof e=="function"||`Expected a function, but received: ${m(e)}`)}function Pe(e){return P("instance",n=>n instanceof e||`Expected a \`${e.name}\` instance, but received: ${m(n)}`)}function $e(){return P("integer",e=>typeof e=="number"&&!isNaN(e)&&Number.isInteger(e)||`Expected an integer, but received: ${m(e)}`)}function Ne(e){return new l({type:"intersection",schema:null,*entries(n,t){for(let r of e)yield*r.entries(n,t)},*validator(n,t){for(let r of e)yield*r.validator(n,t)},*refiner(n,t){for(let r of e)yield*r.refiner(n,t)}})}function je(e){let n=m(e),t=typeof e;return new l({type:"literal",schema:t==="string"||t==="number"||t==="boolean"?e:null,validator(r){return r===e||`Expected the literal \`${n}\`, but received: ${m(r)}`}})}function Se(e,n){return new l({type:"map",schema:null,*entries(t){if(e&&n&&t instanceof Map)for(let[r,o]of t.entries())yield[r,r,e],yield[r,o,n]},coercer(t){return t instanceof Map?new Map(t):t},validator(t){return t instanceof Map||`Expected a \`Map\` object, but received: ${m(t)}`}})}function H(){return P("never",()=>!1)}function Me(e){return new l({...e,validator:(n,t)=>n===null||e.validator(n,t),refiner:(n,t)=>n===null||e.refiner(n,t)})}function Ee(){return P("number",e=>typeof e=="number"&&!isNaN(e)||`Expected a number, but received: ${m(e)}`)}function R(e){let n=e?Object.keys(e):[],t=H();return new l({type:"object",schema:e||null,*entries(r){if(e&&u(r)){let o=new Set(Object.keys(r));for(let a of n)o.delete(a),yield[a,r[a],e[a]];for(let a of o)yield[a,r[a],t]}},validator(r){return p(r)||`Expected an object, but received: ${m(r)}`},coercer(r,o){if(!p(r))return r;let a={...r};if(o.mask&&e)for(let f in a)e[f]===void 0&&delete a[f];return a}})}function q(e){return new l({...e,validator:(n,t)=>n===void 0||e.validator(n,t),refiner:(n,t)=>n===void 0||e.refiner(n,t)})}function Ae(e,n){return new l({type:"record",schema:null,*entries(t){if(u(t))for(let r in t){let o=t[r];yield[r,r,e],yield[r,o,n]}},validator(t){return p(t)||`Expected an object, but received: ${m(t)}`},coercer(t){return p(t)?{...t}:t}})}function Oe(){return P("regexp",e=>e instanceof RegExp)}function De(e){return new l({type:"set",schema:null,*entries(n){if(e&&n instanceof Set)for(let t of n)yield[t,t,e]},coercer(n){return n instanceof Set?new Set(n):n},validator(n){return n instanceof Set||`Expected a \`Set\` object, but received: ${m(n)}`}})}function V(){return P("string",e=>typeof e=="string"||`Expected a string, but received: ${m(e)}`)}function _e(e){let n=H();return new l({type:"tuple",schema:null,*entries(t){if(Array.isArray(t)){let r=Math.max(e.length,t.length);for(let o=0;o<r;o++)yield[o,t[o],e[o]||n]}},validator(t){return Array.isArray(t)||`Expected an array, but received: ${m(t)}`},coercer(t){return Array.isArray(t)?t.slice():t}})}function z(e){let n=Object.keys(e);return new l({type:"type",schema:e,*entries(t){if(u(t))for(let r of n)yield[r,t[r],e[r]]},validator(t){return p(t)||`Expected an object, but received: ${m(t)}`},coercer(t){return p(t)?{...t}:t}})}function We(e){let n=e.map(t=>t.type).join(" | ");return new l({type:"union",schema:null,coercer(t,r){for(let o of e){let[a,f]=o.validate(t,{coerce:!0,mask:r.mask});if(!a)return f}return t},validator(t,r){let o=[];for(let a of e){let[...f]=k(t,a,r),[b]=f;if(b[0])for(let[g]of f)g&&o.push(g);else return[]}return[`Expected the value to satisfy a union of \`${n}\`, but received: ${m(t)}`,...o]}})}function Y(){return P("unknown",()=>!0)}function L(e,n,t){return new l({...e,coercer:(r,o)=>I(r,n)?e.coercer(t(r,o),o):e.coercer(r,o)})}function ve(e,n,t={}){return L(e,Y(),r=>{let o=typeof n=="function"?n():n;if(r===void 0)return o;if(!t.strict&&S(r)&&S(o)){let a={...r},f=!1;for(let b in o)a[b]===void 0&&(a[b]=o[b],f=!0);if(f)return a}return r})}function Re(e){return L(e,V(),n=>n.trim())}function ze(e){return _(e,"empty",n=>{let t=G(n);return t===0||`Expected an empty ${e.type} but received one with a size of \`${t}\``})}function G(e){return e instanceof Map||e instanceof Set?e.size:e.length}function Je(e,n,t={}){let{exclusive:r}=t;return _(e,"max",o=>r?o<n:o<=n||`Expected a ${e.type} less than ${r?"":"or equal to "}${n} but received \`${o}\``)}function Te(e,n,t={}){let{exclusive:r}=t;return _(e,"min",o=>r?o>n:o>=n||`Expected a ${e.type} greater than ${r?"":"or equal to "}${n} but received \`${o}\``)}function Fe(e){return _(e,"nonempty",n=>G(n)>0||`Expected a nonempty ${e.type} but received an empty one`)}function Ue(e,n){return _(e,"pattern",t=>n.test(t)||`Expected a ${e.type} matching \`/${n.source}/\` but received "${t}"`)}function Ie(e,n,t=n){let r=`Expected a ${e.type}`,o=n===t?`of \`${n}\``:`between \`${n}\` and \`${t}\``;return _(e,"size",a=>{if(typeof a=="number"||a instanceof Date)return n<=a&&a<=t||`${r} ${o} but received \`${a}\``;if(a instanceof Map||a instanceof Set){let{size:f}=a;return n<=f&&f<=t||`${r} with a size ${o} but received one with a size of \`${f}\``}else{let{length:f}=a;return n<=f&&f<=t||`${r} with a length ${o} but received one with a length of \`${f}\``}})}function _(e,n,t){return new l({...e,*refiner(r,o){yield*e.refiner(r,o);let a=t(r,o),f=y(a,o,e,r);for(let b of f)yield{...b,refinement:n}}})}i.Struct=l,i.StructError=s,i.any=me,i.array=ye,i.assert=N,i.assign=se,i.bigint=he,i.boolean=be,i.coerce=L,i.create=A,i.date=ge,i.defaulted=ve,i.define=P,i.deprecated=ae,i.dynamic=ce,i.empty=ze,i.enums=we,i.func=ke,i.instance=Pe,i.integer=$e,i.intersection=Ne,i.is=I,i.lazy=fe,i.literal=je,i.map=Se,i.mask=J,i.max=Je,i.min=Te,i.never=H,i.nonempty=Fe,i.nullable=Me,i.number=Ee,i.object=R,i.omit=de,i.optional=q,i.partial=ue,i.pattern=Ue,i.pick=le,i.record=Ae,i.refine=_,i.regexp=Oe,i.set=De,i.size=Ie,i.string=V,i.struct=pe,i.trimmed=Re,i.tuple=_e,i.type=z,i.union=We,i.unknown=Y,i.validate=W})});var d=require("electron"),$=O(require("node:path"),1),C=O(require("node:fs/promises"),1),B=O(require("node:worker_threads"),1);function X(i,s){let c=new URL(i),u=new URL(s);return c.search="",c.hash="",u.search="",u.hash="",u.toString().startsWith(c.toString())}var v=O(require("fs/promises"),1),D=O(require("path"),1);async function Z(i){let s={},c=await v.readdir(i);return await Promise.all(c.map(async u=>{let p=D.join(i,u);if((await v.stat(p)).isDirectory()){let m=await Z(p);Object.assign(s,m)}else{let m=await v.readFile(p);s[p]=m}})),s}async function K(i){let s=await Z(i),c={};return Object.keys(s).forEach(u=>{let S=D.relative(i,u).split(D.sep).join(D.posix.sep);c[S]=s[u]}),c}var ne=O(require("path"),1),U=O(require("fs/promises"),1),h=O(ee(),1),Xe=h.object({entrypoint:h.string(),embed:h.defaulted(h.boolean(),!1),idbfsMountpoints:h.optional(h.array(h.string())),nodeJsWorker:h.defaulted(h.boolean(),!1),nodefsMountpoints:h.optional(h.record(h.string(),h.string()))});async function te(){let i=ne.resolve(__dirname,"../stlite-manifest.json"),s=await U.readFile(i,{encoding:"utf-8"}),c=JSON.parse(s);return h.assert(c,Xe),c}function Ze(i,s){let c=/\{\{(.*?)\}\}/g;return s.replace(c,(u,p)=>{try{return i.getPath(p)}catch{return console.warn(`Unknown placeholder: ${p}`),u}})}function re(i,s){return Object.fromEntries(Object.entries(s).map(([c,u])=>[c,Ze(i,u)]))}function ie(i){return Promise.all(Object.values(i).map(s=>U.mkdir(s,{recursive:!0}))).catch(s=>{console.error("Failed to create nodefs mountpoints",s)}).then()}var oe=async()=>{let i=await te(),s=[];s.push(`--entrypoint=${JSON.stringify(i.entrypoint)}`),i.idbfsMountpoints&&s.push(`--idbfs-mountpoints=${JSON.stringify(i.idbfsMountpoints)}`),i.nodeJsWorker&&s.push("--nodejs-worker");let c=new d.BrowserWindow({width:1280,height:720,webPreferences:{preload:$.join(__dirname,"preload.js"),sandbox:!0,additionalArguments:s}}),u=new URL((d.app.isPackaged,"file:///index.html")),p=new URLSearchParams;i.embed&&p.set("embed","true"),u.search=p.toString();let S=u.toString(),m=y=>y==null?!1:X(S,y.url),M=(y,k)=>{if(!m(y.senderFrame))throw new Error(`Invalid IPC sender (${k}) ${y.senderFrame?.url??"(null)"}`)};d.ipcMain.handle("readSitePackagesSnapshot",y=>{M(y,"readSitePackagesSnapshot");let k=$.resolve(__dirname,"../site-packages-snapshot.tar.gz");return C.readFile(k)}),d.ipcMain.handle("readPrebuiltPackageNames",async y=>{M(y,"readPrebuiltPackageNames");let k=$.resolve(__dirname,"../prebuilt-packages.txt");return(await C.readFile(k,{encoding:"utf-8"})).split(`
`).map(N=>N.trim()).filter(N=>N.length>0)}),d.ipcMain.handle("readStreamlitAppDirectory",async y=>{M(y,"readStreamlitAppDirectory");let k=$.resolve(__dirname,"../app_files");return K(k)}),c.on("closed",()=>{d.ipcMain.removeHandler("readSitePackagesSnapshot"),d.ipcMain.removeHandler("readPrebuiltPackageNames"),d.ipcMain.removeHandler("readStreamlitAppDirectory")});let E=null;d.ipcMain.handle("initializeNodeJsWorker",async y=>{M(y,"initializeNodeJsWorker");let k=$.resolve(__dirname,"..","pyodide","pyodide.mjs"),l=i.nodefsMountpoints&&re(d.app,i.nodefsMountpoints);l&&await ie(l);function N(A){c.webContents.send("messageFromNodeJsWorker",A)}E=new B.default.Worker($.resolve(__dirname,"worker.js"),{env:{PYODIDE_URL:k,...i.nodefsMountpoints&&{NODEFS_MOUNTPOINTS:JSON.stringify(l)}}}),E.on("message",A=>{N(A)})}),d.ipcMain.on("messageToNodeJsWorker",(y,{data:k,portId:l})=>{if(M(y,"messageToNodeJsWorker"),E==null)return;let N=new B.default.MessageChannel;N.port1.on("message",J=>{y.reply(`nodeJsWorker-portMessage-${l}`,J)});let A={data:k,port:N.port2};E.postMessage(A,[N.port2])}),d.ipcMain.handle("terminateNodeJsWorker",y=>{M(y,"terminateNodeJsWorker"),E?.terminate(),E=null}),c.on("closed",()=>{d.ipcMain.removeHandler("initializeNodeJsWorker"),d.ipcMain.removeHandler("messageToNodeJsWorker"),d.ipcMain.removeHandler("terminateNodeJsWorker")}),c.loadURL(S),d.app.isPackaged||c.webContents.openDevTools()};d.app.enableSandbox();d.app.commandLine.appendSwitch("disable-features","PlzDedicatedWorker");d.app.whenReady().then(()=>{let i=$.resolve(__dirname,"..");d.protocol.handle("file",s=>{let c=new URL(s.url).pathname;if(!$.isAbsolute(c))return d.net.fetch(s,{bypassCustomProtocolHandlers:!0});let u=$.normalize($.join(i,c)),p=new Request("file://"+u,s);return d.net.fetch(p,{bypassCustomProtocolHandlers:!0})}),oe(),d.app.on("activate",()=>{d.BrowserWindow.getAllWindows().length===0&&oe()})});d.app.on("window-all-closed",()=>{process.platform!=="darwin"&&d.app.quit()});d.app.on("web-contents-created",(i,s)=>{s.on("will-attach-webview",c=>{c.preventDefault()}),s.on("will-navigate",(c,u)=>{console.debug("will-navigate",u),c.preventDefault()}),s.setWindowOpenHandler(({url:c})=>(console.error("Opening a new window is not allowed.",c),{action:"deny"}))});
