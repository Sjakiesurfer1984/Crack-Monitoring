import{r as l,E as L,_ as M,c as u,D as ge,A as S,j as i,b$ as he,bH as G,bV as Q,bC as q,bW as E,bu as me,cc as fe,bQ as xe,b_ as be,cd as w,bO as ve,ce as ye,L as U,bS as we,bR as je}from"./index-OxGwEg3m.js";import{g as Ce,C as Ie,I as ze,F as k,E as Fe,a as Ee,s as Re,u as He,b as Te}from"./FileHelper-BNpeYRlH.js";import{I as Le}from"./InputInstructions-DuxSO2sS.js";import{i as Me}from"./inputUtils-CQWz5UKz.js";import{a as J}from"./index-t--hEgTQ.js";import{U as Z}from"./UploadFileInfo-C-jY39rj.js";import{T as Se}from"./textarea-Cy6EVtfz.js";import"./base-input-NsRtpzFx.js";var ee=l.forwardRef(function(e,t){var s={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement(L,M({iconAttrs:s,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),l.createElement("path",{fill:"none",d:"M0 0h24v24H0V0z"}),l.createElement("path",{d:"M16.5 6v11.5c0 2.21-1.79 4-4 4s-4-1.79-4-4V5a2.5 2.5 0 015 0v10.5c0 .55-.45 1-1 1s-1-.45-1-1V6H10v9.5a2.5 2.5 0 005 0V5c0-2.21-1.79-4-4-4S7 2.79 7 5v12.5c0 3.04 2.46 5.5 5.5 5.5s5.5-2.46 5.5-5.5V6h-1.5z"}))});ee.displayName="AttachFile";var te=l.forwardRef(function(e,t){var s={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement(L,M({iconAttrs:s,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),l.createElement("path",{d:"M11 15h2v2h-2v-2zm0-8h2v6h-2V7zm.99-5C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8z"}))});te.displayName="ErrorOutline";var ie=l.forwardRef(function(e,t){var s={fill:"currentColor",xmlns:"http://www.w3.org/2000/svg"};return l.createElement(L,M({iconAttrs:s,iconVerticalAlign:"middle",iconViewBox:"0 0 24 24"},e,{ref:t}),l.createElement("rect",{width:24,height:24,fill:"none"}),l.createElement("path",{d:"M3 5.51v3.71c0 .46.31.86.76.97L11 12l-7.24 1.81c-.45.11-.76.51-.76.97v3.71c0 .72.73 1.2 1.39.92l15.42-6.49c.82-.34.82-1.5 0-1.84L4.39 4.58C3.73 4.31 3 4.79 3 5.51z"}))});ie.displayName="Send";const Ue=u("div",{target:"e1d2x3se4"})({name:"1nibcdy",styles:"border:none;position:relative;display:flex"}),ke=u("div",{target:"e1d2x3se3"})(({theme:e,extended:t})=>({border:`${e.sizes.borderWidth} solid`,borderColor:e.colors.widgetBorderColor??e.colors.transparent,borderRadius:e.radii.chatInput,backgroundColor:e.colors.secondaryBg,position:"relative",flexGrow:1,display:"flex",alignItems:"center",paddingLeft:e.spacing.lg,maxHeight:t?"none":e.sizes.minElementHeight,gap:e.spacing.sm,overflow:"hidden",":focus-within":{borderColor:e.colors.primary}}),""),$e=u("button",{target:"e1d2x3se2"})(({theme:e,disabled:t,extended:s})=>{const c=ge(e),[m,p]=c?[e.colors.gray60,e.colors.gray80]:[e.colors.gray80,e.colors.gray40];return{border:"none",backgroundColor:e.colors.transparent,borderTopRightRadius:s?"0":e.radii.chatInput,borderTopLeftRadius:s?e.radii.default:"0",borderBottomRightRadius:e.radii.chatInput,display:"inline-flex",alignItems:"center",justifyContent:"center",lineHeight:e.lineHeights.none,margin:e.spacing.none,padding:e.spacing.sm,color:t?m:p,pointerEvents:"auto","&:focus":{outline:"none"},":focus":{outline:"none"},"&:focus-visible":{backgroundColor:c?e.colors.gray10:e.colors.gray90},"&:hover":{color:e.colors.primary},"&:disabled, &:disabled:hover, &:disabled:active":{backgroundColor:e.colors.transparent,borderColor:e.colors.transparent,color:e.colors.gray,cursor:"not-allowed"}}},""),Be=u("div",{target:"e1d2x3se1"})(({theme:e})=>({display:"flex",alignItems:"flex-end",height:"100%",position:"absolute",right:0,marginBottom:`-${e.sizes.borderWidth}`,pointerEvents:"none"}),""),Ne=u("div",{target:"e1d2x3se0"})(({theme:e})=>({position:"absolute",bottom:"0px",right:`calc(${e.iconSizes.xl} + 2 * ${e.spacing.sm} + ${e.spacing.sm})`}),""),Pe=u("div",{target:"e3id6jz12"})(({theme:e,height:t})=>({backgroundColor:e.colors.transparent,position:"absolute",left:0,bottom:0,minHeight:`max(${e.sizes.emptyDropdownHeight}, ${t})`,width:"100%",zIndex:e.zIndices.priority}),""),De=u("div",{target:"e3id6jz11"})(({theme:e,height:t})=>({border:`${e.sizes.borderWidth} solid`,borderColor:e.colors.primary,borderRadius:e.radii.chatInput,backgroundColor:e.colors.secondaryBg,color:e.colors.primary,display:"flex",alignItems:"center",justifyContent:"center",height:t,width:"100%",fontWeight:e.fontWeights.bold}),""),Ve=u("div",{target:"e3id6jz10"})(({theme:e,disabled:t})=>({display:"flex",alignItems:"top",height:"100%",marginTop:`-${e.sizes.borderWidth}`,cursor:t?"not-allowed":"auto"}),""),We=u("div",{target:"e3id6jz9"})(({disabled:e})=>({pointerEvents:e?"none":"auto"}),""),Ae=u("div",{target:"e3id6jz8"})(({theme:e})=>({marginTop:"0.625em",marginLeft:e.spacing.sm,height:e.spacing.xl,width:e.sizes.borderWidth,backgroundColor:e.colors.fadedText20}),""),Oe=u("div",{target:"e3id6jz7"})(({theme:e})=>({left:0,right:0,lineHeight:e.lineHeights.tight,paddingLeft:e.spacing.sm,paddingRight:e.spacing.sm,overflowX:"auto"}),""),Ke=u("div",{target:"e3id6jz6"})({name:"zjik7",styles:"display:flex"}),Xe=u("div",{target:"e3id6jz5"})({name:"ou8xsw",styles:"flex:0 0 auto"}),Ye=u("div",{target:"e3id6jz4"})(({theme:e})=>({display:"flex",alignItems:"center",padding:e.spacing.sm,gap:e.spacing.twoXS}),""),_e=u("div",{target:"e3id6jz3"})(({theme:e})=>({color:e.colors.fadedText60}),""),Ge=u("div",{target:"e3id6jz2"})(({theme:e,fileStatus:t})=>({overflow:"hidden",textOverflow:"ellipsis",whiteSpace:"nowrap",color:t.type==="uploaded"?e.colors.bodyText:e.colors.fadedText60}),""),Qe=u("div",{target:"e3id6jz1"})(({theme:e})=>({marginRight:e.spacing.md,color:e.colors.fadedText60}),""),qe=u("small",{target:"e3id6jz0"})(({theme:e})=>({display:"flex",alignItems:"center",maxHeight:e.sizes.smallElementHeight,color:e.colors.fadedText60,"& :hover":{color:e.colors.bodyText}}),"");function Je({children:e,content:t}){const s=S();return i.jsx(he,{content:t,placement:G.TOP,overrides:{Body:{style:{top:`-${s.sizes.minElementHeight}`}}},children:e})}const Ze=({fileInfo:e})=>{const t=S(),{type:s}=e.status;switch(s){case"uploading":return i.jsx(fe,{usingCustomTheme:!1,"data-testid":"stChatInputFileIconSpinner",size:"lg",margin:"0",padding:"0"});case"error":return i.jsx(Je,{content:e.status.errorMessage,children:i.jsx(E,{color:t.colors.red,content:te,size:"lg"})});case"uploaded":return i.jsx(E,{content:ze,size:"lg"});default:return me(s),null}},et=({fileInfo:e,onDelete:t})=>i.jsxs(Ye,{className:"stChatInputFile","data-testid":"stChatInputFile",children:[i.jsx(_e,{children:i.jsx(Ze,{fileInfo:e})}),i.jsx(Ge,{className:"stChatInputFileName","data-testid":"stChatInputFileName",title:e.name,fileStatus:e.status,children:e.name}),i.jsx(Qe,{children:Ce(e.size,k.Byte)}),i.jsx(qe,{"data-testid":"stChatInputDeleteBtn",children:i.jsx(Q,{onClick:()=>t(e.id),kind:q.MINIMAL,children:i.jsx(E,{content:Ie,size:"lg"})})})]}),tt=({items:e,onDelete:t})=>i.jsx(Oe,{"data-testid":"stChatUploadedFiles",children:i.jsx(Ke,{children:e.map(s=>i.jsx(Xe,{children:i.jsx(et,{fileInfo:s,onDelete:t})},s.id))})}),it=({getNextLocalFileId:e,addFiles:t,updateFile:s,uploadClient:c,element:m,onUploadProgress:p,onUploadComplete:f})=>(j,h)=>{const x=J.CancelToken.source(),g=new Z(h.name,h.size,e(),{type:"uploading",cancelToken:x,progress:1});t([g]),c.uploadFile({formId:"",...m},j.uploadUrl,h,d=>p(d,g.id),x.token).then(()=>f(g.id,j)).catch(d=>{J.isCancel(d)||s(g.id,g.setStatus({type:"error",errorMessage:d?d.toString():"Unknown error"}))})},ot=({acceptMultipleFiles:e,maxFileSize:t,uploadClient:s,uploadFile:c,addFiles:m,getNextLocalFileId:p,deleteExistingFiles:f,onUploadComplete:j})=>(h,x)=>{if(!e&&h.length===0&&x.length>1){const g=x.findIndex(d=>{var b;return((b=d.errors)==null?void 0:b[0].code)===Fe.TooManyFiles});g>=0&&(h.push(x[g].file),x.splice(g,1))}if(!e&&h.length>0&&f(),s.fetchFileURLs(h).then(g=>{xe(g,h).forEach(([d,b])=>{c(d,b)})}).catch(g=>{m(h.map(d=>new Z(d.name,d.size,p(),{type:"error",errorMessage:g})))}),x.length>0){const g=x.map(d=>Ee(d,p(),t));m(g)}j()},rt=({getRootProps:e,getInputProps:t,acceptFile:s,disabled:c,theme:m})=>i.jsxs(Ve,{disabled:c,children:[i.jsxs(We,{"data-testid":"stChatInputFileUploadButton",disabled:c,...e(),children:[i.jsx("input",{...t()}),i.jsx(be,{content:`Upload or drag and drop ${s===w.Multiple?"files":"a file"}`,placement:G.TOP,onMouseEnterDelay:500,children:i.jsx(Q,{kind:q.MINIMAL,disabled:c,children:i.jsx(E,{content:ee,size:"lg",color:c?m.colors.fadedText40:m.colors.fadedText60})})})]}),i.jsx(Ae,{})]}),st=({getRootProps:e,getInputProps:t,acceptFile:s,inputHeight:c})=>i.jsxs(i.Fragment,{children:[i.jsx(Pe,{height:c,...e(),children:i.jsx("input",{...t()})}),i.jsx(De,{height:c,children:`Drag and drop ${s===w.Multiple?"files":"a file"} here`})]}),nt=6.5,$=1,B=(e,t,s)=>s.map(c=>c.id===e?t:c),N=(e,t)=>t.find(s=>s.id===e);function at({disabled:e,element:t,widgetMgr:s,fragmentId:c,uploadClient:m}){const p=S(),f=l.useRef(null),j=l.useRef(0),h=l.useRef({minHeight:0,maxHeight:0}),[x,g]=ve(),[d,b]=l.useState(t.default),[z,P]=l.useState(0),[R,oe]=l.useState(!1),[C,I]=l.useState([]),[F,H]=l.useState(!1),T=l.useMemo(()=>C.some(o=>o.status.type==="uploading")?!1:d!==""||C.length>0,[C,d]),v=ye(t.acceptFile),D=Re(t.maxUploadSizeMb,k.Megabyte,k.Byte),V=l.useCallback(o=>I(r=>[...r,...o]),[]),W=l.useCallback(o=>{I(r=>{const a=N(o,r);return U(a)?r:(a.status.type==="uploading"&&a.status.cancelToken.cancel(),a.status.type==="uploaded"&&a.status.fileUrls.deleteUrl&&m.deleteFile(a.status.fileUrls.deleteUrl),r.filter(n=>n.id!==o))})},[m]),re=()=>{const o=C.filter(r=>r.status.type==="uploaded").map(r=>{const{name:a,size:n,status:y}=r,{fileId:pe,fileUrls:ue}=y;return new we({fileId:pe,fileUrls:ue,name:a,size:n})});return new je({uploadedFileInfo:o})},A=()=>j.current++,se=ot({acceptMultipleFiles:v===w.Multiple,maxFileSize:D,uploadClient:m,uploadFile:it({getNextLocalFileId:A,addFiles:V,updateFile:(o,r)=>{I(a=>B(o,r,a))},uploadClient:m,element:t,onUploadProgress:(o,r)=>{I(a=>{const n=N(r,a);if(U(n)||n.status.type!=="uploading")return a;const y=Math.round(o.loaded*100/o.total);return n.status.progress===y?a:B(r,n.setStatus({type:"uploading",cancelToken:n.status.cancelToken,progress:y}),a)})},onUploadComplete:(o,r)=>{I(a=>{const n=N(o,a);return U(n)||n.status.type!=="uploading"?a:B(n.id,n.setStatus({type:"uploaded",fileId:r.fileId,fileUrls:r}),a)})}}),addFiles:V,getNextLocalFileId:A,deleteExistingFiles:()=>C.forEach(o=>W(o.id)),onUploadComplete:()=>{f.current&&f.current.focus()}}),{getRootProps:O,getInputProps:K}=He({onDrop:se,multiple:v===w.Multiple,accept:Te(t.fileType),maxSize:D}),ne=()=>{let o=0;const{current:r}=f;if(r){const a=r.placeholder;r.placeholder="",r.style.height="auto",o=r.scrollHeight,r.placeholder=a,r.style.height=""}return o},X=()=>{if(f.current&&f.current.focus(),!T||e)return;const o={data:d,fileUploaderState:re()};s.setChatInputValue(t,o,{fromUi:!0},c),I([]),b(""),P(0)},ae=o=>{const{metaKey:r,ctrlKey:a,shiftKey:n}=o;Me(o)&&!n&&!a&&!r&&(o.preventDefault(),X())},le=o=>{const{value:r}=o.target,{maxChars:a}=t;a!==0&&r.length>a||(b(r),P(ne()))};l.useEffect(()=>{if(t.setValue){t.setValue=!1;const o=t.value||"";b(o)}},[t]),l.useLayoutEffect(()=>{if(f.current){const{offsetHeight:o}=f.current;h.current.minHeight=o,h.current.maxHeight=o*nt}},[f]),l.useEffect(()=>{const o=n=>{var y;n.preventDefault(),n.stopPropagation(),!F&&(y=n.dataTransfer)!=null&&y.types.includes("Files")&&H(!0)},r=n=>{n.preventDefault(),n.stopPropagation(),F&&(n.clientX<=0&&n.clientY<=0||n.clientX>=window.innerWidth&&n.clientY>=window.innerHeight)&&H(!1)},a=n=>{n.preventDefault(),n.stopPropagation(),F&&H(!1)};return window.addEventListener("dragover",o),window.addEventListener("drop",a),window.addEventListener("dragleave",r),()=>{window.removeEventListener("dragover",o),window.removeEventListener("drop",a),window.removeEventListener("dragleave",r)}},[F]),l.useLayoutEffect(()=>{const{minHeight:o}=h.current;oe(z>0&&f.current?Math.abs(z-o)>$:!1)},[z]);const{placeholder:Y,maxChars:de}=t,{maxHeight:_}=h.current,ce=v!==w.None&&F;return i.jsxs(i.Fragment,{children:[v===w.None?null:i.jsx(tt,{items:[...C],onDelete:W}),i.jsx(Ue,{className:"stChatInput","data-testid":"stChatInput",ref:g,children:ce?i.jsx(st,{getRootProps:O,getInputProps:K,acceptFile:v,inputHeight:R?`${z+$}px`:p.sizes.minElementHeight}):i.jsxs(ke,{extended:R,children:[v===w.None?null:i.jsx(rt,{getRootProps:O,getInputProps:K,acceptFile:v,disabled:e,theme:p}),i.jsx(Se,{inputRef:f,value:d,placeholder:Y,onChange:le,onKeyDown:ae,"aria-label":Y,disabled:e,rows:1,overrides:{Root:{style:{minHeight:p.sizes.minElementHeight,outline:"none",borderLeftWidth:"0",borderRightWidth:"0",borderTopWidth:"0",borderBottomWidth:"0",borderTopLeftRadius:"0",borderTopRightRadius:"0",borderBottomRightRadius:"0",borderBottomLeftRadius:"0"}},Input:{props:{"data-testid":"stChatInputTextArea"},style:{lineHeight:p.lineHeights.inputWidget,"::placeholder":{opacity:"0.7"},height:R?`${z+$}px`:"auto",maxHeight:_?`${_}px`:"none",paddingLeft:p.spacing.none,paddingBottom:p.spacing.sm,paddingTop:p.spacing.sm,paddingRight:`calc(${p.iconSizes.xl} + 2 * ${p.spacing.sm} + ${p.spacing.sm})`}}}}),x>p.breakpoints.hideWidgetDetails&&i.jsx(Ne,{children:i.jsx(Le,{dirty:T,value:d,maxLength:de,type:"chat",inForm:!1})}),i.jsx(Be,{children:i.jsx($e,{onClick:X,disabled:!T||e,extended:R,"data-testid":"stChatInputSubmitButton",children:i.jsx(E,{content:ie,size:"xl",color:"inherit"})})})]})})]})}const lt=l.memo(at);export{lt as default};
