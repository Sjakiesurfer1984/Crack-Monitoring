import{r,b as J}from"./index-OxGwEg3m.js";import{s as Q,i as P,a as U,b as Z,T as _,C as ee,m as te}from"./index-BfXMsSNA.js";import"./FormClearHelper-DxeY-rII.js";import"./withFullScreenWrapper-CEJUxUJC.js";import"./Toolbar-CJ0mD5An.js";import"./checkbox-Dj0lswiB.js";import"./mergeWith-D2cULMN8.js";import"./sprintf-D7DtBTRn.js";import"./createDownloadLinkElement-DZMwyjvU.js";import"./slicedToArray-HZKHLTaA.js";import"./inherits-BbfuKc-R.js";import"./createSuper-Ipqc67nc.js";import"./FileDownload.esm-Bzb3HjS9.js";const re=()=>t=>t.targetX,ie=()=>t=>t.targetY,oe=()=>t=>t.targetWidth,ne=()=>t=>t.targetHeight,ae=()=>t=>t.targetY+10,se=()=>t=>Math.max(0,(t.targetHeight-28)/2),de=Q("div")({name:"DataGridOverlayEditorStyle",class:"gdg-d19meir1",propsAsIs:!1,vars:{"d19meir1-0":[ie(),"px"],"d19meir1-1":[re(),"px"],"d19meir1-2":[oe(),"px"],"d19meir1-3":[ne(),"px"],"d19meir1-4":[ae(),"px"],"d19meir1-5":[se(),"px"]}});function le(){const[t,n]=r.useState();return[t??void 0,n]}function ce(){const[t,n]=le(),[o,p]=r.useState(0),[g,b]=r.useState(!0);r.useLayoutEffect(()=>{if(t===void 0||!("IntersectionObserver"in window))return;const a=new IntersectionObserver(s=>{s.length!==0&&b(s[0].isIntersecting)},{threshold:1});return a.observe(t),()=>a.disconnect()},[t]),r.useEffect(()=>{if(g||t===void 0)return;let a;const s=()=>{const{right:k}=t.getBoundingClientRect();p(v=>Math.min(v+window.innerWidth-k-10,0)),a=requestAnimationFrame(s)};return a=requestAnimationFrame(s),()=>{a!==void 0&&cancelAnimationFrame(a)}},[t,g]);const C=r.useMemo(()=>({transform:`translateX(${o}px)`}),[o]);return{ref:n,style:C}}const ue=t=>{const{target:n,content:o,onFinishEditing:p,forceEditMode:g,initialValue:b,imageEditorOverride:C,markdownDivCreateNode:a,highlight:s,className:k,theme:v,id:V,cell:w,bloom:f,validateCell:c,getCellRenderer:M,provideEditor:x,isOutsideClick:W,customEventTarget:X}=t,[d,Y]=r.useState(g?o:void 0),O=r.useRef(d??o);O.current=d??o;const[h,N]=r.useState(()=>c===void 0?!0:!(P(o)&&(c==null?void 0:c(w,o,O.current))===!1)),u=r.useCallback((e,i)=>{p(h?e:void 0,i)},[h,p]),q=r.useCallback(e=>{if(c!==void 0&&e!==void 0&&P(e)){const i=c(w,e,O.current);i===!1?N(!1):(typeof i=="object"&&(e=i),N(!0))}Y(e)},[w,c]),y=r.useRef(!1),m=r.useRef(void 0),B=r.useCallback(()=>{u(d,[0,0]),y.current=!0},[d,u]),G=r.useCallback((e,i)=>{u(e,i??m.current??[0,0]),y.current=!0},[u]),j=r.useCallback(async e=>{let i=!1;e.key==="Escape"?(e.stopPropagation(),e.preventDefault(),m.current=[0,0]):e.key==="Enter"&&!e.shiftKey?(e.stopPropagation(),e.preventDefault(),m.current=[0,1],i=!0):e.key==="Tab"&&(e.stopPropagation(),e.preventDefault(),m.current=[e.shiftKey?-1:1,0],i=!0),window.setTimeout(()=>{!y.current&&m.current!==void 0&&(u(i?d:void 0,m.current),y.current=!0)},0)},[u,d]),S=d??o,[l,L]=r.useMemo(()=>{var e,i;if(U(o))return[];const K=x==null?void 0:x(o);return K!==void 0?[K,!1]:[(i=(e=M(o))==null?void 0:e.provideEditor)==null?void 0:i.call(e,o),!1]},[o,M,x]),{ref:$,style:z}=ce();let R=!0,F,I=!0,E;if(l!==void 0){R=l.disablePadding!==!0,I=l.disableStyling!==!0;const e=Z(l);e&&(E=l.styleOverride);const i=e?l.editor:l;F=r.createElement(i,{isHighlighted:s,onChange:q,value:S,initialValue:b,onFinishedEditing:G,validatedSelection:P(S)?S.selectionRange:void 0,forceEditMode:g,target:n,imageEditorOverride:C,markdownDivCreateNode:a,isValid:h,theme:v})}E={...E,...z};const T=document.getElementById("portal");if(T===null)return console.error('Cannot open Data Grid overlay editor, because portal not found.  Please add `<div id="portal" />` as the last child of your `<body>`.'),null;let D=I?"gdg-style":"gdg-unstyle";h||(D+=" gdg-invalid"),R&&(D+=" gdg-pad");const A=(f==null?void 0:f[0])??1,H=(f==null?void 0:f[1])??1;return J.createPortal(r.createElement(_.Provider,{value:v},r.createElement(ee,{style:te(v),className:k,onClickOutside:B,isOutsideClick:W,customEventTarget:X},r.createElement(de,{ref:$,id:V,className:D,style:E,as:L===!0?"label":void 0,targetX:n.x-A,targetY:n.y-H,targetWidth:n.width+A*2,targetHeight:n.height+H*2},r.createElement("div",{className:"gdg-clip-region",onKeyDown:j},F)))),T)};export{ue as default};
